%{
#include "y.tab.h"  /* Token definitions generated by bison */
%}

%option noyywrap

DIGIT          [0-9]
WHITESPACE     [ \t]
NEWLINE        [\n\r]
IDENTIFIER     [_a-zA-Z][_a-zA-Z0-9]*
/* [ \t\n] */

%%

\/\/.*                   /* ignore comments */
^#.*$                    /* ignore comments */
{WHITESPACE}+            /* ignore whitespace */
{NEWLINE}                { yylineno++; }

map { return MAP; }
material { return MATERIAL; }
entity { return ENTITY; }
action { return ACTION; }
extends { return EXTENDS; }
with { return WITH; }
\+= { return EQ_ADD; }
\-= { return EQ_SUB; }
\*= { return EQ_MUL; }
\/= { return EQ_DIV; }
'.' { return MAP_TILE; }
on_touch { return ON_TOUCH; }
on_interact { return ON_INTERACT; }


true                     { return TRUE; }
false                    { return FALSE; }
maybe(\({DIGIT}+\))?     { return MAYBE; }

[+-]?{DIGIT}+            {
    sscanf(yytext, "%d", &yylval.val);
    return INTEGER;
            }
\".*\"                   {
    yylval.str = malloc( yyleng-1 );
    memcpy( yylval.str, yytext+1, yyleng-2 );
    yylval.str[yyleng-1]='\0';
    return STRING;
}

{IDENTIFIER}             { return IDENTIFIER; }
{IDENTIFIER}(\.{IDENTIFIER})+   { return COMPOUND_IDENTIFIER; }

.                        { return yytext[0]; }
